---
// src/components/Header.astro
---
<nav class="bg-white border-b border-slate-200">
  <div class="max-w-6xl mx-auto px-6 h-20 flex justify-between items-center">
    <a href="/" class="flex flex-col group relative z-[1001] shrink-0">
      <span class="text-xl font-black tracking-tighter text-slate-900 leading-none group-hover:text-emerald-600 transition">ZNAJ GRANICE</span>
      <span class="text-[9px] uppercase tracking-[0.2em] font-bold text-emerald-600 mt-1 whitespace-nowrap">Fundacja Przeciwdziałania Uzależnieniu od Hazardu</span>
    </a>

    <div id="desktop-menu" class="hidden xl:flex gap-5 items-center font-bold text-[12px] uppercase tracking-wide text-slate-600 shrink-0">
      <a href="/" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Główna</a>
      <a href="#o-nas" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">O nas</a>
      <a href="#zespol" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Zespół</a>
      <a href="#misja" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Misja</a>
      <a href="#dzialania" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Działania</a>
      <a href="#partnerzy" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Partnerzy</a>
      <a href="#kontakt" data-nav-link class="nav-link hover:text-emerald-600 transition whitespace-nowrap py-7">Kontakt</a>
      <a href="#darowizna" class="bg-emerald-600 text-white px-5 py-2.5 rounded-full text-xs shadow-lg hover:bg-emerald-700 transition shadow-emerald-100 whitespace-nowrap ml-2">
        Wspieram
      </a>
    </div>

    <button id="hamburger" class="xl:hidden p-2 text-slate-900 relative z-[1001]" aria-label="Menu">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 open-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 close-icon hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <div id="mobile-menu" class="fixed inset-0 bg-white z-[1000] flex flex-col items-center justify-center gap-8 translate-x-full transition-transform duration-300 xl:hidden">
      <nav class="flex flex-col items-center gap-6 font-black text-2xl uppercase tracking-tighter text-slate-900">
        <a href="/" class="mobile-link">Główna</a>
        <a href="#o-nas" class="mobile-link">O nas</a>
        <a href="#zespol" class="mobile-link">Zespół</a>
        <a href="#misja" class="mobile-link">Misja</a>
        <a href="#dzialania" class="mobile-link">Działania</a>
        <a href="#partnerzy" class="mobile-link">Partnerzy</a>
        <a href="#kontakt" class="mobile-link">Kontakt</a>
        <a href="#darowizna" class="bg-emerald-600 text-white px-8 py-4 rounded-full text-lg shadow-xl mobile-link">Wspieram</a>
      </nav>
    </div>
  </div>
</nav>

<style>
  /* Klasa aktywnego linku wyzwalana przez JS */
  .nav-link-active {
    @apply text-slate-900 font-black border-b-2 border-emerald-500;
  }
</style>

<script>
  // --- OBSŁUGA HAMBURGERA ---
  const btn = document.getElementById('hamburger');
  const menu = document.getElementById('mobile-menu');
  const links = document.querySelectorAll('.mobile-link');
  const openIcon = document.querySelector('.open-icon');
  const closeIcon = document.querySelector('.close-icon');

  function toggleMenu() {
    menu.classList.toggle('translate-x-full');
    openIcon.classList.toggle('hidden');
    closeIcon.classList.toggle('hidden');
    document.body.classList.toggle('overflow-hidden');
  }

  btn.addEventListener('click', toggleMenu);
  links.forEach(link => link.addEventListener('click', toggleMenu));

  // --- OBSŁUGA AKTYWNEJ POZYCJI W MENU (Scroll Spy) ---
  const navLinks = document.querySelectorAll('[data-nav-link]');
  const sections = document.querySelectorAll('section[id]');

  const options = {
    threshold: 0.3, // Sekcja musi być widoczna w 30%, żeby ją zaznaczyć
    rootMargin: "-20% 0px -70% 0px" // Skupiamy się na górnej części ekranu
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        
        navLinks.forEach((link) => {
          link.classList.remove('nav-link-active');
          if (link.getAttribute('href') === `#${id}`) {
            link.classList.add('nav-link-active');
          }
        });

        // Specjalny przypadek dla "Główna" (jeśli jesteśmy na samej górze)
        if (window.scrollY < 100) {
          navLinks.forEach(l => l.classList.remove('nav-link-active'));
          navLinks[0].classList.add('nav-link-active');
        }
      }
    });
  }, options);

  sections.forEach((section) => observer.observe(section));

  // Dodatkowe sprawdzenie przy przewijaniu na samą górę
  window.addEventListener('scroll', () => {
    if (window.scrollY < 100) {
      navLinks.forEach(l => l.classList.remove('nav-link-active'));
      navLinks[0].classList.add('nav-link-active');
    }
  });
</script>